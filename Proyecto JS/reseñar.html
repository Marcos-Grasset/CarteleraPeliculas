<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reseñar Película</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" href="./images/icono.JPG" />
  </head>
  <body>
    <header>
      <h1>
        <img
          src="./images/reseñar.gif"
          alt="Descripción de la imagen"
          class="header-img"
        />
      </h1>
    </header>

    <main id="main_reseña">
      <img
        id="pelicula-imagen"
        src=""
        alt="Imagen de la película"
        style="width: 200px; height: auto"
      />
      <h2 id="pelicula-nombre"></h2>
      <div id="estrellas"></div>
      <textarea
        id="comentario"
        placeholder="Escribe tu comentario aquí"
      ></textarea>
      <button id="guardar-reseña">Guardar Reseña</button>
    </main>

    <footer>
      <div style="display: flex; align-items: center; justify-content: center">
        <img
          src="./images/icono.JPG"
          alt="Icono"
          style="width: 30px; height: 20px; margin: 0; padding: 0"
        />
        <p style="margin-left: 8px">
          © 2024 Cartelera de Peliculas - Sitio web creado por Marcos Grasset &
          Nicolás Ojeda - Todos los derechos reservados.
        </p>
      </div>
    </footer>

    <script>
      const peliculaData = JSON.parse(
        localStorage.getItem("peliculaSeleccionada")
      );

      if (peliculaData) {
        document.getElementById("pelicula-imagen").src = peliculaData.imagen;
        document.getElementById("pelicula-nombre").textContent =
          peliculaData.nombre;
      }

      const estrellasDiv = document.getElementById("estrellas");
      for (let i = 1; i <= 5; i++) {
        const estrella = document.createElement("span");
        estrella.textContent = "★";
        estrella.classList.add("estrella");
        estrella.dataset.valor = i;
        estrella.onclick = function () {
          seleccionarPuntuacion(i);
        };
        estrellasDiv.appendChild(estrella);
      }

      let puntuacionSeleccionada = 0;

      function seleccionarPuntuacion(valor) {
        puntuacionSeleccionada = valor;
        const estrellas = document.querySelectorAll(".estrella");
        estrellas.forEach((estrella) => {
          estrella.style.color =
            estrella.dataset.valor <= valor ? "gold" : "black";
        });
      }

      const reseñas = JSON.parse(localStorage.getItem("reseñas")) || [];
      const reseñaExistente = reseñas.find(
        (reseña) => reseña.pelicula === peliculaData.nombre
      );

      if (reseñaExistente) {
        document.getElementById("comentario").value =
          reseñaExistente.comentario;
        seleccionarPuntuacion(reseñaExistente.estrellas);
      }

      document.getElementById("guardar-reseña").onclick = function () {
        const comentario = document.getElementById("comentario").value;
        if (puntuacionSeleccionada > 0 && comentario.trim()) {
          const indiceReseña = reseñas.findIndex(
            (reseña) => reseña.pelicula === peliculaData.nombre
          );

          if (indiceReseña !== -1) {
            reseñas[indiceReseña].comentario = comentario;
            reseñas[indiceReseña].estrellas = puntuacionSeleccionada;
          } else {
            reseñas.push({
              pelicula: peliculaData.nombre,
              estrellas: puntuacionSeleccionada,
              comentario,
            });
          }

          localStorage.setItem("reseñas", JSON.stringify(reseñas));
          alert("Reseña guardada.");
          window.location.href = "index.html";
        } else {
          alert(
            "Por favor, seleccione una puntuación y escriba un comentario antes de guardar."
          );
        }
      };
    </script>

  </body>
</html>